@model IEnumerable<Warehouse.Models.ProductOrder>
@{
    ViewData["Title"] = "Show";
}

<h2>Show</h2>

<table class="table table-striped">
    <tr>
        <th>Product</th>
        <th>Barcode</th>
        <th>ProductType</th>
        <th>Count</th>
        <th>ChangeCount</th>
        <th>Unit</th>
        <th>Price</th>
        <th>FinallyPrice</th>
        <th>User</th>
        <th>Back</th>
    </tr>
    @{
        foreach (var p in Model)
        {
    <tr>
        @{
            var count = p.Count - p.ReturnedCount;
        }
        <td hidden="hidden"><input id="id" type="hidden" value="@p.Id" /></td>
        <td>@p.Product.Name</td>
        <td>@p.Product.Barcode</td>
        <td>@p.Product.ProductType.Name</td>
        <td>@count</td>
        <td><input type="number" name="count" /></td>
        <td>@p.Product.Unit.Name</td>
        <td>@p.Price</td>
        <td>@p.FinallyPrice</td>
        <td>@p.ProductManager.User.Name</td>
        <td><a name="back">Back</a></td>
    </tr>
        }
    }
</table>

@section Scripts{
    <script src="https://kit.fontawesome.com/b7938c82ea.js"></script>
    <link href="~/css/jquery-confirm.min.css" rel="stylesheet" />
    <script src="~/js/jquery-confirm.min.js"></script>

    @{await Html.RenderPartialAsync("_ValidationScriptsPartial.cshtml");}
    <script>
        $(() => {
            //Before adding to the cart check the quantity of product
            $("a[name='back']").on("click", function () {
                $(this).parent().parent().addClass("select");
                let $inputCount = $(".select").children().find("input[name='count']");
                let $id = $(".select").children().children().val();
                $(this).parent().parent().removeClass();
                    $.ajax({
                        type: 'POST',
                        url: '/Order/FinallyBack/',
                        data: { 'id': $id, 'count': $inputCount.val() },
                        success: function (data) {
                            if (data) {
                                $inputCount.val(0);
                            }
                        }
                    });
            });
        });
    </script>
}
